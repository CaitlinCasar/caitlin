<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ggplot | Caitlin Casar</title>
    <link>/tag/ggplot/</link>
      <atom:link href="/tag/ggplot/index.xml" rel="self" type="application/rss+xml" />
    <description>ggplot</description>
    <generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>en-us</language><lastBuildDate>Sun, 31 May 2020 21:14:16 -0500</lastBuildDate>
    <image>
      <url>/images/icon_hu65d040ff31842b946eaf5b8caef82e07_3065_512x512_fill_lanczos_center_2.png</url>
      <title>ggplot</title>
      <link>/tag/ggplot/</link>
    </image>
    
    <item>
      <title>Making figures for microbial ecology</title>
      <link>/post/making_figs/</link>
      <pubDate>Sun, 31 May 2020 21:14:16 -0500</pubDate>
      <guid>/post/making_figs/</guid>
      <description>
&lt;script src=&#34;../../rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;../../rmarkdown-libs/pymjs/pym.v1.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;../../rmarkdown-libs/widgetframe-binding/widgetframe.js&#34;&gt;&lt;/script&gt;


&lt;a class=&#34;github-button&#34; href=&#34;https://github.com/CaitlinCasar/Casar2020_DeMMO_MineralHostedBiofilms&#34; data-icon=&#34;octicon-repo-forked&#34; aria-label=&#34;Fork ntkme/github-buttons on GitHub&#34;&gt;Fork&lt;/a&gt;
&lt;script async defer src=&#34;https://buttons.github.io/buttons.js&#34;&gt;&lt;/script&gt;
&lt;p&gt;This is a tutorial for making figures that are common in microbial ecology. Here I’m using data and code from my publication in Geobiolgy. You can fork the repo by clicking the button above!&lt;/p&gt;
&lt;p&gt;To generate the data, we sequenced DNA from microbial communities at our study site DeMMO. The raw sequence data was processed with QIIME to produce an OTU table. OTUs, or operational taxonomic units, are bins that differentiate sequences at a 97% similarity threshold. For our purposes, you can think of an OTU as a species of bacteria or archaea. As a microbial ecologist, you might want to compare your microbial communities in terms of alpha or beta diversity. Let’s make some plots to explore our microbial communities!&lt;/p&gt;
&lt;p&gt;Before we get started, you’ll need to set up your environment in R. This code depends on the packages being loaded here:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#load libraries 
pacman::p_load(tidyverse, readr, plyr, plotly, lubridate)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Next, read the OTU data into a dataframe. We can pull the data directy from Github by reading the raw file. You can preview the data in the table below this code chunk.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#read the data into a dataframe
otu_table &amp;lt;- read_delim(&amp;quot;https://raw.githubusercontent.com/CaitlinCasar/Casar2020_DeMMO_MineralHostedBiofilms/master/orig_data/DeMMO136_Dec2015toApril2018_noChimera_otuTable_withTaxa_d10000.txt&amp;quot;, delim=&amp;quot;\t&amp;quot;, comment = &amp;quot;# &amp;quot;)
metadata &amp;lt;- read_csv(&amp;quot;https://raw.githubusercontent.com/CaitlinCasar/Casar2020_DeMMO_MineralHostedBiofilms/master/orig_data/metadata.csv&amp;quot;) &lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-1&#34; style=&#34;width:100%;height:400px;&#34; class=&#34;widgetframe html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-1&#34;&gt;{&#34;x&#34;:{&#34;url&#34;:&#34;/post/making_figs_files/figure-html//widgets/widget_unnamed-chunk-3.html&#34;,&#34;options&#34;:{&#34;xdomain&#34;:&#34;*&#34;,&#34;allowfullscreen&#34;:false,&#34;lazyload&#34;:false}},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;We want to look at the community compositions, so first let’s normalize and reshape the data.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;abundance_table &amp;lt;- otu_table %&amp;gt;%
  select(-taxonomy) %&amp;gt;%
  mutate_at(vars(-`#OTU ID`), funs(./sum(.)*100)) %&amp;gt;% #normalize to relative abundance 
  gather(sample_id, abundance, `7.DeMMO1.Steri.050917`:`18.800.DitchFluid.041818`) &lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-2&#34; style=&#34;width:100%;height:400px;&#34; class=&#34;widgetframe html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-2&#34;&gt;{&#34;x&#34;:{&#34;url&#34;:&#34;/post/making_figs_files/figure-html//widgets/widget_unnamed-chunk-5.html&#34;,&#34;options&#34;:{&#34;xdomain&#34;:&#34;*&#34;,&#34;allowfullscreen&#34;:false,&#34;lazyload&#34;:false}},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;Now let’s make a function for viewing the data at a few different taxonomic levels.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;taxon_abundance &amp;lt;- function(level, name){
  otu_table %&amp;gt;%
    select(`#OTU ID`, taxonomy) %&amp;gt;%
    mutate(taxonomy = gsub(&amp;quot;Gammaproteobacteria; D_3__Betaproteobacteriales&amp;quot;, &amp;quot;Betaproteobacteria; D_3__Betaproteobacteriales&amp;quot;, taxonomy),
           taxa = str_extract(taxonomy, level),
           taxa = if_else(is.na(taxa), taxonomy, taxa)) %&amp;gt;%
    right_join(abundance_table) %&amp;gt;%
    ungroup() %&amp;gt;%
    group_by(sample_id, taxa) %&amp;gt;%
    summarise(abundance = sum(abundance)) %&amp;gt;%
    left_join(metadata) %&amp;gt;% #add metadata
    group_by(site, experiment.type, taxa) %&amp;gt;% 
    summarise(abundance = sum(abundance))
}

family_level &amp;lt;- &amp;quot;(.*)(?=; D_5__)&amp;quot;
class_level &amp;lt;- &amp;quot;(.*)(?=; D_3__)&amp;quot;
phylum_level &amp;lt;- &amp;quot;(.*)(?=; D_2__)&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now, we can selecy the taxonomic level in our function and recalculate the relative abundances. Let’s take a look at the phylum level.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;taxon_abundance_table &amp;lt;- taxon_abundance(family_level, &amp;quot;phylum&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>
