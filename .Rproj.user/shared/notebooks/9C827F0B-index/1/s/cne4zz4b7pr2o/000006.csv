"0","activities <- activities %>%"
"0","  pivot_longer(`Ca+2`:CO, names_to = ""react_prod"", values_to = ""activity"") #pivot from wide to long for joining"
"0","logQ <- reactions %>%"
"0","  pivot_longer(reactant.a:state.i,"
"0","               names_to = c("".value"", ""set""),"
"0","               names_pattern = ""(.+).(.+)"") %>% #pivot from wide to long "
"0","  unite(""react_prod"", reactant:product, na.rm = TRUE, remove = F) %>% #unite the reactant and product columns into one column called react_prod "
"0","  left_join(activities) %>% #join with the activities data "
"0","  filter(!is.na(activity)) %>% #remove any activities with NA values "
"0","  mutate(logQ = if_else(!is.na(reactant), -abs(coeff)*activity, abs(coeff)*activity)) %>% #multiply each species by its stoichiometric coefficient "
"0","  group_by(rxn.number, Site) %>% #group on the reaction number and site "
"0","  summarise(logQ = sum(logQ)) #calculate logQ "
"2","Joining, by = ""react_prod""
"
"2","`summarise()` regrouping output by 'rxn.number' (override with `.groups` argument)
"
