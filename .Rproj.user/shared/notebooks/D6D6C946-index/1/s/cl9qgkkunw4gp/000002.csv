"0","bar_plot <- taxon_abundance_table %>%"
"0","  left_join(metadata) %>%"
"0","  group_by(site, experiment.type, taxonomy) %>%"
"0","  summarise(abundance = sum(abundance)) %>%"
"0","  ungroup() %>%"
"0","  mutate(experiment.type = factor(experiment.type, levels = c(""fluid"", ""inert.control"", ""pyrolusite"", ""pyrite"",""hematite"",""magnetite"",""siderite"",""gypsum"",""muscovite"",""calcite""))) %>%"
"0","  ggplot(aes(fill=taxonomy, y=abundance, x=experiment.type)) +"
"0","  geom_bar(stat='identity', position='fill') +"
"0","  scale_fill_manual(values=phylum_color) +"
"0","  coord_flip() + "
"0","  theme(axis.title = element_blank(),"
"0","        legend.title = ggplot2::element_blank(), "
"0","        legend.text = ggplot2::element_text(size = 8),"
"0","        legend.key.size = unit(0.5, ""cm"")) +"
"0","  facet_grid(cols = vars(site), switch = ""y"") + "
"0","  guides(fill = guide_legend(ncol = 1))"
